# ๐ง ุญู ูุดููุฉ ุฅุถุงูุฉ ุงููุชุฏุฑุจูู ุนูู Railway

## ๐ ุงููุดููุฉ
ุนูุฏ ุชุดุบูู ุงููููุน ูุญูููุง: โ ูููู ุฅุถุงูุฉ ุงููุชุฏุฑุจูู ููุฏูุฑุงุช ุจุฏูู ูุดุงูู
ุนูุฏ ุชุดุบูู ุงููููุน ุนูู Railway: โ ูุง ูุชู ุฅุถุงูุฉ ุงููุชุฏุฑุจูู

---

## ๐ ุงูุณุจุจ ุงูุฑุฆูุณู
ุงูููุฏ ุงูุฃุตูู ูุงู ูุนุชูุฏ ุจุดูู ุฃุณุงุณู ุนูู **ููู Excel** (`used_tables_export.xlsx`) ููุจุญุซ ุนู ุจูุงูุงุช ุงูุทุงูุจ:

```python
# ุงูุทุฑููุฉ ุงููุฏููุฉ (ุงูุชู ุชูุดู ุนูู Railway)
1. ุงุจุญุซ ูู ููู Excel
2. ุฅุฐุง ูู ุชุฌุฏุ ุงุจุญุซ ูู ุฌุฏูู sf01

# ุงููุดููุฉ: ููู Excel ุบูุฑ ููุฌูุฏ ุนูู Railway!
```

---

## โ ุงูุญู ุงููุทุจู

### 1๏ธโฃ ุชุบููุฑ ุชุฑุชูุจ ุงูุจุญุซ
ุชู ุชุบููุฑ ุงูููุฏ ููุจุฏุฃ ุจู **ูุงุนุฏุฉ ุงูุจูุงูุงุช** ุจุฏูุงู ูู ููู Excel:

```python
# ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ (ุงูุชู ุชุนูู ุนูู Railway)
1. ุงุจุญุซ ูู ุฌุฏูู sf01 ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช โ ๐ฏ ุงูุฃุณุงุณู
2. ุฅุฐุง ูู ุชุฌุฏุ ุงุจุญุซ ูู ููู Excel โ ุงุฎุชูุงุฑู
```

### 2๏ธโฃ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฎุทุฃ ุฃูุถู
- ุงูุชูุงุท ุฑุณุงุฆู ุงูุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- ุฅุถุงูุฉ `db.rollback()` ุนูุฏ ูุดู ุงูุฅุฏุฑุงุฌ

### 3๏ธโฃ ุงููููุงุช ุงููุนุฏูููุฉ
- ๐ `app/routers/hod.py`:
  - ุฏุงูุฉ `attendance_add_trainee` (ุงูุณุทุฑ 740)
  - ุฏุงูุฉ `enroll_manual_submit` (ุงูุณุทุฑ 906)

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ููุชุญูู

### ุฃููุงู: ุชุดุบูู ุฃุฏุงุฉ ุงูุชุดุฎูุต
```bash
python diagnose_railway.py
```

ูุฐู ุงูุฃุฏุงุฉ ุณุชุชุญูู ูู:
- โ ูุฌูุฏ ููู Excel
- โ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุฌูุฏ ุฌุฏูู `sf01`
- โ ุนุฏุฏ ุงููุชุฏุฑุจูู ูู `sf01`
- โ ูุฌูุฏ ุฌุฏูู `course_enrollments`

### ุซุงููุงู: ุงูุชุญูู ูู ุงูุจูุงูุงุช ุนูู Railway
```bash
# SSH ุฅูู Railway ู ุงุฎุชุจุฑ:
psql $DATABASE_URL -c "SELECT COUNT(*) FROM sf01;"
```

### ุซุงูุซูุง: ุฅุฐุง ูุงู ุฌุฏูู sf01 ูุงุฑุบูุง
ูู ุจุชุญููู ุงูุจูุงูุงุช ูู Excel:
```python
python load_excel_data.py  # ุฅุฐุง ูุงู ุงูููู ููุฌูุฏูุง
```

---

## ๐ ููุงุท ูููุฉ

### โ ุงููุดุงูู ุงููุญุชููุฉ ุงูุฃุฎุฑู:

| ุงููุดููุฉ | ุงูุณุจุจ | ุงูุญู |
|---------|-------|------|
| ุฌุฏูู `sf01` ูุงุฑุบ | ูู ุชูุญูููู ุงูุจูุงูุงุช | ุชุญููู ุงูุจูุงูุงุช ูู Excel |
| ุฑูู ุงููุชุฏุฑุจ ุบูุฑ ููุฌูุฏ | ุงูุจูุงูุงุช ูุงูุตุฉ | ุงูุชุญูู ูู ุฑูู ุงููุชุฏุฑุจ |
| ุฎุทุฃ ูู UNIQUE CONSTRAINT | ูุญุงููุฉ ุฅุถุงูุฉ ููุณ ุงูุทุงูุจ ูุฑุชูู | ุงููุญุต ูุจู ุงูุฅุถุงูุฉ |
| ุฎุทุฃ ูู ุงูุงุชุตุงู | ูุดููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช | ุชุญูู ูู DATABASE_URL |

---

## ๐ ูุซุงู ููุฎุทุฃ ุงูุฐู ุณุชุฑุงู ุงูุขู

**ูุจู ุงูุชุนุฏูู:**
```
โ ูุง ุชูุฌุฏ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ (ูุดู ุตุงูุช)
```

**ุจุนุฏ ุงูุชุนุฏูู:**
```
โ ูุดู ุฅุถุงูุฉ ุงููุชุฏุฑุจ: [database error details]
โ ูุง ููุฌุฏ ูุชุฏุฑุจ ุจุฑูู 2101024 ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุนูููุฉ ุนูู Railway

### 1. ุชุญุฏูุซ ุงูููุฏ
```bash
git add app/routers/hod.py
git commit -m "Fix: Search database first for student data"
git push
```

### 2. ุชุดุบูู ุงูุชุดุฎูุต
```bash
python diagnose_railway.py
```

### 3. ุงุฎุชุจุงุฑ ุงูุฅุถุงูุฉ
- ุงุฏุฎู ูู ุงููููุน ุนูู Railway
- ุญุงูู ุฅุถุงูุฉ ูุชุฏุฑุจ ุจุฑูู ููุฌูุฏ ูุนูุงู ูู `sf01`
- ุชุญูู ูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุฅู ุญุฏุซุช

---

## ๐ก ูุตุงุฆุญ ุชุตุญูุญ ุงูุฃุฎุทุงุก

### ุฅุฐุง ุฑุฃูุช ุงูุฎุทุฃ:
```
"ูุง ููุฌุฏ ูุชุฏุฑุจ ุจุฑูู XXX ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช"
```

โ ุชุญูู:
1. ูู ุฑูู ุงููุชุฏุฑุจ ููุฌูุฏ ูุนูุงู ูู ุฌุฏูู `sf01`ุ
2. ูู ุงูุจูุงูุงุช ูุญููุฉ ุจุดูู ุตุญูุญ ุนูู Railwayุ
3. ูู ููุน ุงูุจูุงูุงุช ุตุญูุญ (ุฑูู/ูุต)ุ

### ุฅุฐุง ุฑุฃูุช ุงูุฎุทุฃ:
```
"ูุดู ุฅุถุงูุฉ ุงููุชุฏุฑุจ: [database error]"
```

โ ุชุญูู ูู:
1. ุฑุณุงุฆู ุงูุณุฌูุงุช (logs) ุนูู Railway
2. ูู ุฌุฏูู `course_enrollments` ููุฌูุฏุ
3. ูู ููุงู ูุณุงุญุฉ ูุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ

---

## ๐ ููุงุญุธุงุช ูููุฉ

โ๏ธ **ุงูููุฏ ุงูุขู ูุจุญุซ ุนู ุงูุจูุงูุงุช ุจูุฐุง ุงูุชุฑุชูุจ:**
1. **ุฃููุงู**: ุฌุฏูู `sf01` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (PostgreSQL ุนูู Railway)
2. **ุซุงููุงู**: ููู Excel `used_tables_export.xlsx` (ูุญูู ููุท)

โ **ูุฐุง ูุนูู:**
- ูุง ุญุงุฌุฉ ูููู Excel ุนูู Railway
- ุงูุจูุงูุงุช ุชูุญูุธ ุชููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูุฃุฏุงุก ุฃุณุฑุน (ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃุณุฑุน)

---

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

ุฌุฑุจ ุงูุฎุทูุงุช ุงูุชุงููุฉ:

### 1. ุชุญูู ูู ุงูุณุฌูุงุช
```bash
# ุนูู Railwayุ ุงุฎุชุฑ "View Logs"
```

### 2. ุงุฎุชุจุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
psql $DATABASE_URL -c "SELECT * FROM sf01 LIMIT 1;"
```

### 3. ุฃุนุฏ ุชุดุบูู ุงูุฎุฏูุฉ
```bash
# ุนูู Railway: Deploy โ Manual Deploy
```

### 4. ุงุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ูุงุญู ุงูุฌุฏูุฏุฉ
```bash
psql $DATABASE_URL -c "TRUNCATE course_enrollments CASCADE;"
# ุซู ุฃุถู ุงููุชุฏุฑุจูู ูู ุฌุฏูุฏ
```

---

## ๐ง ูููุณุงุนุฏุฉ ุงูุฅุถุงููุฉ

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุฑูุจ ุงููุนูููุงุช ุงูุชุงููุฉ:

1. โ ุฅุฎุฑุงุฌ `diagnose_railway.py`
2. โ ุขุฎุฑ ุฑุณุงูุฉ ุฎุทุฃ ูู ุงูุณุฌูุงุช (logs)
3. โ ุฑูู ุงููุชุฏุฑุจ ุงูุฐู ุญุงููุช ุฅุถุงูุชู
4. โ ุงุณู ุงูุฏูุฑุฉ
5. โ ุงุณู ุงููููุฉ

